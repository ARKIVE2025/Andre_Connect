<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Time Logger - Portable v3.5 (ANDRE Ready)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles from the original file */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000000;
            color: white;
            font-family: 'Rubik', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative; /* For lock button positioning */
        }
        
        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: bold;
            color: #00ff9c;
            text-shadow: 0 0 12px rgba(0,255,156,0.12);
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: rgba(255,255,255,0.6);
        }
        
        .portable-info {
            background: linear-gradient(135deg, rgba(0,255,156,0.1) 0%, rgba(0,123,255,0.1) 100%);
            border: 1px solid rgba(0,255,156,0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .portable-info h3 {
            color: #00ff9c;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-family: 'Orbitron', sans-serif;
        }
        
        .portable-info p {
            color: rgba(255,255,255,0.8);
            font-size: 0.95rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        /* NEW: Priority Focus Card Styles */
        .priority-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            background-color: rgba(255,158,11,0.08); /* Amber-based background */
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(245, 158, 11, 0.4); 
            text-align: center;
        }

        .priority-card h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #f59e0b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .priority-message {
            font-size: 1.1rem;
            font-weight: 500;
            color: white;
            margin-bottom: 1rem;
        }

        .priority-action-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .priority-action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .storage-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .storage-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .storage-button.save {
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black;
        }
        
        .storage-button.load {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .storage-button.destination {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .storage-button.reset {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .storage-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .destination-info {
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 0.5rem;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
        }

        .destination-path {
            color: #f59e0b;
            font-weight: 500;
        }
        
        .status-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            text-align: center;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-message.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .status-message.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-message.info {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .form-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(0,255,156,0.1);
        }

        /* NEW: Alert for Completion Nudge */
        .completion-nudge {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background: rgba(245, 158, 11, 0.15); /* Amber alert background */
            border: 1px solid rgba(245, 158, 11, 0.5);
            color: #f59e0b;
            text-align: center;
        }
        
        .form-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #00ff9c;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }
        
        .form-group {
            position: relative;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.5rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(255,255,255,0.06);
            color: white;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #00ff9c;
            box-shadow: 0 0 0 2px rgba(0,255,156,0.1);
        }
        
        .form-input::placeholder, .form-select::placeholder, .form-textarea::placeholder {
            color: rgba(255,255,255,0.4);
        }
        
        .form-textarea {
            height: 96px;
            resize: vertical;
        }
        
        /* NEW: Style for the large project data textarea */
        .form-gigantic-textarea {
            height: 250px; 
            resize: vertical;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 10;
            margin-top: 0.25rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(0,0,0,0.95);
            backdrop-filter: blur(6px);
            overflow: hidden;
        }
        
        .suggestion-item {
            width: 100%;
            padding: 0.5rem 0.75rem;
            text-align: left;
            background: none;
            border: none;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .suggestion-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .submit-button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: none;
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .submit-button:hover { 
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,255,156,0.3);
        }
        
        /* NEW: Calendar submit button styling for differentiation */
        .submit-button.calendar {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        .submit-button.calendar:hover { 
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* New section for Pending Ideas */
        .idea-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .idea-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #f59e0b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .idea-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .idea-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .idea-text {
            color: rgba(255,255,255,0.9);
            flex: 1;
        }
        
        /* NEW: Calendar Card & Events Styles */
        .calendar-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(59, 130, 246, 0.3); /* Blue border for calendar */
        }

        .calendar-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #60a5fa; /* Light blue color */
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .event-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .event-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(59, 130, 246, 0.1); /* Light blue background */
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .event-info {
            flex: 1;
            margin-right: 1rem;
        }
        
        .event-title-date {
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }

        .event-notes {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
        }
        
        .logs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logs-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #00ff9c;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .button-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .export-button, .import-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .export-button { 
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black; 
        }
        .import-button { 
            background: linear-gradient(135deg, #b000ff, #8b00cc);
            color: white; 
        }
        .export-button:hover, .import-button:hover { 
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .logs-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            border-radius: 0.75rem;
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: rgba(255,255,255,0.4);
        }
        
        .empty-text {
            color: rgba(255,255,255,0.6);
        }
        
        .log-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
            position: relative; /* Add position relative for the stripe */
        }
        
        .log-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.8);
        }
        
        .log-card.latest {
            border-color: #00ff9c;
            box-shadow: 0 0 0 2px rgba(0,255,156,0.2), 0 8px 40px rgba(0,0,0,0.6);
        }
        
        .log-card.expanded {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2), 0 8px 40px rgba(0,0,0,0.6);
        }

        .log-card.incomplete {
            border-color: #f87171;
            box-shadow: 0 0 0 2px rgba(248, 113, 113, 0.2), 0 8px 40px rgba(0,0,0,0.6);
        }

        .log-card.complete {
            border-color: #22c55e;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2), 0 8px 40px rgba(0,0,0,0.6);
        }

        /* NEW: Overdue Stripe and Critical Focus Badge */
        .log-card.overdue::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px; /* Thickness of the stripe */
            height: 100%;
            background: #f59e0b; /* Amber color */
            border-top-left-radius: 0.75rem;
            border-bottom-left-radius: 0.75rem;
            opacity: 0.8;
        }
        
        .work-sessions {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .work-sessions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .work-sessions-title {
            color: #3b82f6;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .add-session-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* NEW: Clear Path Nudge Button Style */
        .nudge-complete-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nudge-complete-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .add-session-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .work-session-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .work-session-item:last-child {
            margin-bottom: 0;
        }
        
        .session-info {
            flex: 1;
        }
        
        .session-time {
            color: #60a5fa;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .session-description {
            color: rgba(255,255,255,0.8);
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .session-number {
            color: rgba(255,255,255,0.5);
            font-size: 0.7rem;
            font-weight: 600;
            min-width: fit-content;
        }
        
        .project-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: rgba(255,255,255,0.6);
        }
        
        .expand-toggle {
            background: none;
            border: none;
            color: #60a5fa;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .expand-toggle:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        /* NEW: Data Toggle Button Style */
        .data-toggle-btn {
            background: none;
            border: none;
            color: #f59e0b;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-toggle-btn:hover {
            color: #d97706;
            background: rgba(245, 158, 11, 0.1);
        }
        
        .icon-clock::before {
            content: '‚è∞';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .icon-expand::before {
            content: 'üìä';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .log-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #00ff9c;
            margin-bottom: 0.25rem;
        }
        
        .log-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: rgba(255,255,255,0.6);
            flex-wrap: wrap;
        }
        
        .latest-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .completed-badge, .incomplete-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .completed-badge {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .incomplete-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .complete-toggle-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            background: none;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .complete-toggle-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .edit-project-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            background: none;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .edit-project-btn:hover {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #60a5fa;
        }
        
        .delete-button {
            background: none;
            border: none;
            color: #f87171;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        
        .delete-button:hover { 
            color: #fca5a5; 
            transform: scale(1.1);
        }
        
        .log-details {
            display: grid;
            gap: 1rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        
        @media (min-width: 768px) {
            .log-details { grid-template-columns: 1fr 1fr; }
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            color: rgba(255,255,255,0.6);
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            color: white;
            font-weight: 500;
        }
        
        .log-description {
            margin-top: 1rem;
        }
        
        .description-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .description-content {
            color: rgba(255,255,255,0.9);
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .edit-session-btn {
            background: none;
            border: none;
            color: #60a5fa;
            cursor: pointer;
            margin-left: 0.5rem;
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        .edit-session-btn:hover {
            transform: scale(1.2);
        }
        .edit-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            background-color: rgba(255,255,255,0.03);
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .edit-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        .save-edit-btn, .cancel-edit-btn, .convert-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }
        .save-edit-btn {
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black;
        }
        .cancel-edit-btn {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .convert-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .convert-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .idea-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Edit Project Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: rgba(255,255,255,0.04);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(0,255,156,0.1);
            border-radius: 0.75rem;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh; /* Added max-height for content scroll */
            overflow-y: auto; /* Added overflow for scrollable content */
        }
        .modal-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #00ff9c;
            margin-bottom: 1.5rem;
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
            font-size: 1.5rem;
            color: rgba(255,255,255,0.6);
        }
        .modal-close:hover {
            color: #ef4444;
        }
        
        .log-importance-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        .log-importance-badge.important {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        .log-importance-badge.not-important {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        /* NEW: Critical Focus Badge */
        .log-importance-badge.critical-focus {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); }
            70% { box-shadow: 0 0 0 8px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
        
        .hidden { display: none; }
        
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            position: relative;
        }
        
        .icon-plus::before {
            content: '+';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: bold;
        }
        
        .icon-eye::before {
            content: 'üëÅ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-save::before {
            content: 'üíæ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-download::before {
            content: '‚¨áÔ∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-upload::before {
            content: '‚¨ÜÔ∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-trash::before {
            content: 'üóë';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-folder::before {
            content: 'üìÇ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-usb::before {
            content: 'üíø';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        .icon-destination::before {
            content: 'üìç';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        .icon-reset::before {
            content: 'üîÑ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        .icon-lightbulb::before {
            content: 'üí°';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        /* NEW: Calendar Icon */
        .icon-calendar::before {
            content: 'üóìÔ∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        /* NEW: Priority Icon */
        .icon-priority::before {
            content: 'üåü';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        
        /* === PASSWORD PROTECTION STYLES START === */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .password-container {
            background: rgba(255,255,255,0.06);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(0,255,156,0.3);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            text-align: center;
        }

        .password-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: #00ff9c;
            margin-bottom: 1rem;
            text-shadow: 0 0 12px rgba(0,255,156,0.12);
        }

        .password-subtitle {
            color: rgba(255,255,255,0.6);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .password-input {
            width: 100%;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(255,255,255,0.06);
            color: white;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 1rem;
            font-family: inherit;
        }

        .password-input:focus {
            outline: none;
            border-color: #00ff9c;
            box-shadow: 0 0 0 2px rgba(0,255,156,0.1);
        }

        .password-button {
            width: 100%;
            padding: 1rem;
            border-radius: 0.5rem;
            border: none;
            background: linear-gradient(135deg, #00ff9c, #00cc7a);
            color: black;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .password-button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,255,156,0.3);
        }

        .password-error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            min-height: 1.25rem;
        }

        .password-hint {
            color: rgba(255,255,255,0.4);
            font-size: 0.75rem;
            margin-top: 1rem;
        }

        .lock-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .password-setup-container {
            background: rgba(255,255,255,0.06);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(0,255,156,0.3);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .password-setup-option {
            padding: 1.5rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255,255,255,0.03);
        }

        .password-setup-option:hover {
            border-color: #00ff9c;
            background: rgba(0,255,156,0.05);
        }

        .password-setup-option.selected {
            border-color: #00ff9c;
            background: rgba(0,255,156,0.1);
        }

        .password-strength {
            height: 4px;
            border-radius: 2px;
            margin-top: 0.5rem;
            background: rgba(255,255,255,0.1);
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            transition: all 0.3s;
        }

        .strength-weak { width: 33%; background: #ef4444; }
        .strength-medium { width: 66%; background: #f59e0b; }
        .strength-strong { width: 100%; background: #22c55e; }
        /* === PASSWORD PROTECTION STYLES END === */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // === PASSWORD PROTECTION COMPONENTS START ===
        const PasswordProtection = ({ onUnlock }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [attempts, setAttempts] = useState(0);

            const hashPassword = (pwd) => {
                let hash = 0;
                for (let i = 0; i < pwd.length; i++) {
                    const char = pwd.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(36);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Get stored password hash
                const storedHash = localStorage.getItem('appPasswordHash');
                
                if (!storedHash) {
                    setError('No password set. Please refresh and set up security.');
                    return;
                }

                const inputHash = hashPassword(password);
                
                if (inputHash === storedHash) {
                    // Store unlock timestamp (session-based)
                    sessionStorage.setItem('appUnlocked', Date.now().toString());
                    onUnlock();
                } else {
                    setAttempts(prev => prev + 1);
                    setError(`Incorrect password. Attempt ${attempts + 1}/5`);
                    setPassword('');
                    
                    if (attempts >= 4) {
                        setError('Too many failed attempts. Please refresh the page.');
                    }
                }
            };

            return (
                <div className="password-overlay">
                    <div className="password-container">
                        <div className="lock-icon">üîí</div>
                        <h1 className="password-title">Project Logger</h1>
                        <p className="password-subtitle">Enter your password to access your projects</p>
                        
                        <form onSubmit={handleSubmit}>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                className="password-input"
                                placeholder="Enter password"
                                autoFocus
                                disabled={attempts >= 5}
                            />
                            
                            <button 
                                type="submit" 
                                className="password-button"
                                disabled={attempts >= 5 || !password}
                            >
                                Unlock
                            </button>
                            
                            <div className="password-error">{error}</div>
                        </form>
                        
                        <p className="password-hint">
                            üí° Forgot password? Clear browser data for this file to reset.
                        </p>
                    </div>
                </div>
            );
        };

        const PasswordSetup = ({ onSetup }) => {
            const [setupChoice, setSetupChoice] = useState(null);
            const [newPassword, setNewPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [strength, setStrength] = useState('');

            const hashPassword = (pwd) => {
                let hash = 0;
                for (let i = 0; i < pwd.length; i++) {
                    const char = pwd.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(36);
            };

            const calculateStrength = (pwd) => {
                if (pwd.length < 6) return 'weak';
                if (pwd.length < 10) return 'medium';
                if (pwd.length >= 10 && /[A-Z]/.test(pwd) && /[0-9]/.test(pwd)) return 'strong';
                return 'medium';
            };

            const handlePasswordChange = (pwd) => {
                setNewPassword(pwd);
                setStrength(calculateStrength(pwd));
            };

            const handleSetup = (e) => {
                e.preventDefault();
                
                if (setupChoice === 'skip') {
                    localStorage.setItem('appPasswordHash', 'skip');
                    sessionStorage.setItem('appUnlocked', Date.now().toString());
                    onSetup();
                    return;
                }

                if (newPassword.length < 4) {
                    setError('Password must be at least 4 characters');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    setError('Passwords do not match');
                    return;
                }

                // Hash and store password
                const hashedPassword = hashPassword(newPassword);
                localStorage.setItem('appPasswordHash', hashedPassword);
                sessionStorage.setItem('appUnlocked', Date.now().toString());
                onSetup();
            };

            return (
                <div className="password-overlay">
                    <div className="password-setup-container">
                        <div className="lock-icon">üõ°Ô∏è</div>
                        <h1 className="password-title">Security Setup</h1>
                        <p className="password-subtitle">First time? Set up password protection for your data</p>
                        
                        {!setupChoice ? (
                            <>
                                <div 
                                    className="password-setup-option"
                                    onClick={() => setSetupChoice('password')}
                                >
                                    <h3 style={{ color: '#00ff9c', marginBottom: '0.5rem' }}>üîê Set Password</h3>
                                    <p style={{ color: 'rgba(255,255,255,0.6)', fontSize: '0.875rem' }}>
                                        Protect your data with a password (Recommended)
                                    </p>
                                </div>
                                
                                <div 
                                    className="password-setup-option"
                                    onClick={() => setSetupChoice('skip')}
                                >
                                    <h3 style={{ color: '#f59e0b', marginBottom: '0.5rem' }}>‚ö†Ô∏è Skip Protection</h3>
                                    <p style={{ color: 'rgba(255,255,255,0.6)', fontSize: '0.875rem' }}>
                                        Use without password (Not recommended on shared computers)
                                    </p>
                                </div>
                            </>
                        ) : setupChoice === 'password' ? (
                            <form onSubmit={handleSetup}>
                                <input
                                    type="password"
                                    value={newPassword}
                                    onChange={(e) => handlePasswordChange(e.target.value)}
                                    className="password-input"
                                    placeholder="Create password"
                                    autoFocus
                                />
                                
                                {newPassword && (
                                    <>
                                        <div className="password-strength">
                                            <div className={`password-strength-bar strength-${strength}`}></div>
                                        </div>
                                        <p style={{ fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)', marginTop: '0.25rem' }}>
                                            Strength: {strength}
                                        </p>
                                    </>
                                )}
                                
                                <input
                                    type="password"
                                    value={confirmPassword}
                                    onChange={(e) => setConfirmPassword(e.target.value)}
                                    className="password-input"
                                    placeholder="Confirm password"
                                    style={{ marginTop: '1rem' }}
                                />
                                
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button 
                                        type="button"
                                        onClick={() => setSetupChoice(null)}
                                        className="password-button"
                                        style={{ background: 'rgba(255,255,255,0.1)', color: 'white' }}
                                    >
                                        Back
                                    </button>
                                    <button 
                                        type="submit" 
                                        className="password-button"
                                    >
                                        Set Password
                                    </button>
                                </div>
                                
                                <div className="password-error">{error}</div>
                                
                                <p className="password-hint">
                                    üí° Remember this password - there's no recovery option!
                                </p>
                            </form>
                        ) : (
                            <form onSubmit={handleSetup}>
                                <p style={{ color: 'rgba(255,255,255,0.8)', marginBottom: '1.5rem' }}>
                                    Are you sure you want to proceed without password protection?
                                </p>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button 
                                        type="button"
                                        onClick={() => setSetupChoice(null)}
                                        className="password-button"
                                        style={{ background: 'rgba(255,255,255,0.1)', color: 'white' }}
                                    >
                                        Back
                                    </button>
                                    <button 
                                        type="submit" 
                                        className="password-button"
                                        style={{ background: 'linear-gradient(135deg, #f59e0b, #d97706)' }}
                                    >
                                        Continue Without Password
                                    </button>
                                </div>
                            </form>
                        )}
                    </div>
                </div>
            );
        };
        // === PASSWORD PROTECTION COMPONENTS END ===


        // Function must be defined outside the component or be a stable callback
        const isOverdue = (project) => {
            if (project.importance === 'important' && project.completionDate) {
                const completionDate = new Date(project.completionDate);
                const now = new Date();
                // Set the completion time to the end of the day for fair comparison
                completionDate.setHours(23, 59, 59, 999); 
                return completionDate < now && !project.isComplete;
            }
            return false;
        };

        const formatDate = (dateString, format = 'YYYY-MM-DD') => {
            if (!dateString) return '';
            const date = new Date(dateString);
            if (format === 'YYYY-MM-DD') {
                // Formatting date to YYYY-MM-DD string
                return date.toISOString().split('T')[0];
            }
            return date.toLocaleDateString();
        };

        const calculatePriority = (projects, events) => {
            // Filter out archived projects before calculating priority
            const activeProjects = projects.filter(p => !p.isArchived);
            
            if (activeProjects.length === 0 && events.length === 0) {
                return {
                    message: "No current projects or events. Time to log a new idea!",
                    action: "add-idea",
                    projectId: null
                };
            }

            const now = new Date();
            const today = formatDate(now);
            const sevenDays = 7 * 24 * 60 * 60 * 1000;
            
            // 1. Check for Overdue Important Projects (Highest Priority)
            const overdueProject = activeProjects.find(p => isOverdue(p));
            if (overdueProject) {
                return {
                    message: `CRITICAL: Overdue Project - Complete **${overdueProject.name}** now!`,
                    action: "focus-project",
                    projectId: overdueProject.id
                };
            }

            // 2. Check for Important Projects Missing Completion Date (Right Focus Nudge)
            const missingDate = activeProjects.find(p => p.importance === 'important' && !p.completionDate && !p.isComplete);
            if (missingDate) {
                return {
                    message: `Right Focus: Set a deadline for **${missingDate.name}** (ANDRE Nudge).`,
                    action: "edit-project",
                    projectId: missingDate.id
                };
            }

            // 3. Check for Pending Completion (Clear Path Nudge)
            const isReadyToReview = (project) => {
                const sessions = project.workSessions || [];
                if (project.isComplete || sessions.length < 5) return false;
                
                const lastSessionTimestamp = sessions.reduce((latest, session) => {
                    const currentTimestamp = new Date(session.timestamp).getTime();
                    return currentTimestamp > latest ? currentTimestamp : latest;
                }, 0);

                return (now.getTime() - lastSessionTimestamp) > sevenDays;
            };

            const readyToReview = activeProjects.find(p => isReadyToReview(p));
            
            if (readyToReview) {
                return {
                    message: `Clear Path: **${readyToReview.name}** may be ready for review/closure.`,
                    action: "complete-project",
                    projectId: readyToReview.id
                };
            }

            // 4. Check for Upcoming Events (Calendar Priority)
            const sortedEvents = events.filter(e => e.date >= today).sort((a, b) => new Date(a.date) - new Date(b.date));
            const nextEvent = sortedEvents[0];

            if (nextEvent) {
                const eventDate = new Date(nextEvent.date);
                const diffDays = Math.ceil((eventDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
                return {
                    message: `Upcoming: **${nextEvent.title}** is in ${diffDays} day${diffDays !== 1 ? 's' : ''}.`,
                    action: "focus-event",
                    eventId: nextEvent.id
                };
            }

            // 5. Default: Latest Incomplete Project
            const latestProject = activeProjects.filter(p => !p.isComplete).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
            if (latestProject) {
                return {
                    message: `Focus: Continue work on **${latestProject.name}**.`,
                    action: "focus-project",
                    projectId: latestProject.id
                };
            }

            return {
                message: "All clear! Enjoy your downtime or start a new task.",
                action: "none",
                projectId: null
            };
        };


        const ProjectTimeLogger = () => {
            // === PASSWORD STATE START ===
            const [isLocked, setIsLocked] = useState(true);
            const [needsSetup, setNeedsSetup] = useState(false);
            // === PASSWORD STATE END ===

            // State management for project logs, pending ideas, and UI controls.
            const [projects, setProjects] = useState([]); 
            const [pendingIdeas, setPendingIdeas] = useState([]);
            const [calendarEvents, setCalendarEvents] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);
            const [statusMessage, setStatusMessage] = useState('');
            const [expandedProject, setExpandedProject] = useState(null);
            
            const [editingProject, setEditingProject] = useState(null); 
            const [localEditingProject, setLocalEditingProject] = useState(null); 
            
            const [editingSession, setEditingSession] = useState(null); 
            
            const [exportDestination, setExportDestination] = useState(null);
            const [showCompletionDate, setShowCompletionDate] = useState(false); 
            
            // NEW: State for hiding/showing large data for privacy
            const [visibleDataId, setVisibleDataId] = useState(null); 
            
            // NEW: State for showing/hiding the archive section
            const [showArchive, setShowArchive] = useState(false);

            const [currentProject, setCurrentProject] = useState({
                name: '',
                account: '',
                aiModel: '',
                description: '',
                largeData: '',
                importance: 'not_important',
                completionDate: ''
            });
            const [currentIdea, setCurrentIdea] = useState('');
            
            const [currentEvent, setCurrentEvent] = useState({
                title: '',
                date: '',
                notes: ''
            });

            const [accountSuggestions, setAccountSuggestions] = useState([]);
            const [showAccountSuggestions, setShowAccountSuggestions] = useState(false);
            const fileInputRef = useRef(null);
            const dataFileInputRef = useRef(null);
            
            const isFileSystemAccessSupported = typeof window !== 'undefined' && 'showDirectoryPicker' in window;

            // Load data from localStorage on mount.
            useEffect(() => {
                try {
                    const savedProjects = localStorage.getItem('projectLogs');
                    if (savedProjects) {
                        const parsed = JSON.parse(savedProjects);
                        if (Array.isArray(parsed)) {
                            // FIXED: Ensure ALL projects (including archived) have isArchived field
                            const sanitizedProjects = parsed.map(p => ({
                                ...p,
                                // Preserve existing isArchived value, default to false only if undefined
                                isArchived: p.isArchived === true,
                            }));
                            setProjects(sanitizedProjects);
                        }
                    }
                    
                    const savedIdeas = localStorage.getItem('pendingIdeas');
                    if (savedIdeas) {
                        const parsedIdeas = JSON.parse(savedIdeas);
                        if (Array.isArray(parsedIdeas)) {
                            setPendingIdeas(parsedIdeas);
                        }
                    }

                    const savedEvents = localStorage.getItem('calendarEvents');
                    if (savedEvents) {
                        const parsedEvents = JSON.parse(savedEvents);
                        if (Array.isArray(parsedEvents)) {
                            setCalendarEvents(parsedEvents);
                        }
                    }

                    const savedDestination = localStorage.getItem('exportDestination');
                    if (savedDestination && isFileSystemAccessSupported) {
                        setExportDestination(JSON.parse(savedDestination));
                    }
                } catch (error) {
                    console.error('Error loading data from localStorage:', error);
                }
                setIsLoaded(true);
            }, []);

            // === PASSWORD AUTH CHECK useEffect START ===
            useEffect(() => {
                const passwordHash = localStorage.getItem('appPasswordHash');
                const unlockTime = sessionStorage.getItem('appUnlocked');
                
                if (!passwordHash) {
                    // First time user - show setup
                    setNeedsSetup(true);
                    setIsLocked(false); // Temporarily unlock to show setup screen
                } else if (passwordHash === 'skip') {
                    // User chose to skip password
                    setIsLocked(false);
                    setNeedsSetup(false);
                } else if (unlockTime) {
                    // Check if session is still valid (within 30 minutes)
                    const thirtyMinutes = 30 * 60 * 1000;
                    const now = Date.now();
                    if (now - parseInt(unlockTime) < thirtyMinutes) {
                        setIsLocked(false);
                        setNeedsSetup(false);
                    } else {
                        sessionStorage.removeItem('appUnlocked');
                        setIsLocked(true);
                        setNeedsSetup(false);
                    }
                } else {
                    setIsLocked(true);
                    setNeedsSetup(false);
                }
            }, []);
            // === PASSWORD AUTH CHECK useEffect END ===

            // Sync editingProject to localEditingProject when modal opens
            useEffect(() => {
                if (editingProject) {
                    setLocalEditingProject({ ...editingProject }); 
                    setShowCompletionDate(editingProject.importance === 'important'); 
                } else {
                    setLocalEditingProject(null);
                    setShowCompletionDate(false);
                }
            }, [editingProject]); 

            // Save projects and ideas to localStorage whenever they change.
            useEffect(() => {
                if (isLoaded) {
                    try {
                        localStorage.setItem('projectLogs', JSON.stringify(projects));
                    } catch (error) {
                        console.error('Error saving projects to localStorage:', error);
                    }
                }
            }, [projects, isLoaded]);
            
            useEffect(() => {
                if (isLoaded) {
                    try {
                        localStorage.setItem('pendingIdeas', JSON.stringify(pendingIdeas));
                    } catch (error) {
                        console.error('Error saving ideas to localStorage:', error);
                    }
                }
            }, [pendingIdeas, isLoaded]);
            
            useEffect(() => {
                if (isLoaded) {
                    try {
                        localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
                    } catch (error) {
                        console.error('Error saving calendar events to localStorage:', error);
                    }
                }
            }, [calendarEvents, isLoaded]);

            // Save export destination to localStorage
            useEffect(() => {
                if (exportDestination) {
                    try {
                        localStorage.setItem('exportDestination', JSON.stringify({
                            name: exportDestination.name,
                        }));
                    } catch (error) {
                        console.error('Error saving export destination:', error);
                    }
                }
            }, [exportDestination]);

            // Get unique accounts from previous entries for suggestions
            useEffect(() => {
                const uniqueAccounts = [...new Set(projects.map(p => p.account).filter(Boolean))];
                setAccountSuggestions(uniqueAccounts);
            }, [projects]);
            
            // Function to handle priority action button click
            const handlePriorityAction = () => {
                const priority = calculatePriority(projects, calendarEvents);
                switch (priority.action) {
                    case 'focus-project':
                    case 'complete-project':
                        setExpandedProject(priority.projectId);
                        // Using a simple check to scroll to the project element
                        const projectElement = document.getElementById(priority.projectId);
                        if (projectElement) projectElement.scrollIntoView({ behavior: 'smooth' });
                        break;
                    case 'edit-project':
                        const projectToEdit = projects.find(p => p.id === priority.projectId);
                        if (projectToEdit) openEditProjectModal(projectToEdit);
                        break;
                    case 'add-idea':
                        document.getElementById('idea-box')?.scrollIntoView({ behavior: 'smooth' });
                        break;
                    case 'focus-event':
                        document.getElementById('calendar-card')?.scrollIntoView({ behavior: 'smooth' });
                        break;
                    default:
                        // Scroll to the main logs view
                        document.getElementById('view-logs')?.scrollIntoView({ behavior: 'smooth' });
                        break;
                }
            };


            // Show status message with auto-hide
            const showStatus = (message, type = 'success') => {
                setStatusMessage({ text: message, type });
                setTimeout(() => setStatusMessage(''), 4000);
            };

            const chooseExportDestination = async () => {
                if (!isFileSystemAccessSupported) {
                    showStatus('‚ö†Ô∏è File System Access API not supported in this browser. Files will download to default location.', 'info');
                    return;
                }

                try {
                    const directoryHandle = await window.showDirectoryPicker({
                        mode: 'readwrite',
                        startIn: 'documents'
                    });
                    
                    setExportDestination(directoryHandle);
                    showStatus(`üìç Export destination set to: ${directoryHandle.name}`, 'success');
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        console.error('Error choosing export destination:', error);
                        showStatus('‚ùå Error selecting export destination. Please try again.', 'error');
                    }
                }
            };

            const resetExportDestination = () => {
                try {
                    setExportDestination(null);
                    localStorage.removeItem('exportDestination');
                    showStatus('üîÑ Export destination reset. Files will download to default location.', 'info');
                } catch (error) {
                    console.error('Error resetting export destination:', error);
                    showStatus('‚ùå Error resetting destination.', 'error');
                }
            };

            const saveToDestination = async (filename, data, contentType = 'application/json') => {
                if (exportDestination && isFileSystemAccessSupported) {
                    try {
                        const fileHandle = await exportDestination.getFileHandle(filename, { create: true });
                        const writable = await fileHandle.createWritable();
                        
                        if (contentType === 'application/json') {
                            await writable.write(JSON.stringify(data, null, 2));
                        } else {
                            await writable.write(data);
                        }
                        
                        await writable.close();
                        return true;
                    } catch (error) {
                        console.error('Error saving to destination:', error);
                        showStatus('‚ö†Ô∏è Could not save to chosen destination. Downloading to default location instead.', 'info');
                    }
                }

                try {
                    let dataBlob;
                    if (contentType === 'application/json') {
                        dataBlob = new Blob([JSON.stringify(data, null, 2)], { type: contentType });
                    } else {
                        dataBlob = new Blob([data], { type: contentType });
                    }
                    
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    return true;
                } catch (error) {
                    console.error('Error with fallback download:', error);
                    return false;
                }
            };

            const saveDataFile = async () => {
                try {
                    const dataToSave = {
                        projects: projects,
                        pendingIdeas: pendingIdeas,
                        calendarEvents: calendarEvents,
                        lastUpdated: new Date().toISOString(),
                        version: '1.3'
                    };
                    
                    const filename = 'project-logs-data.json';
                    const success = await saveToDestination(filename, dataToSave);
                    
                    if (success) {
                        if (exportDestination && isFileSystemAccessSupported) {
                            showStatus(`‚úÖ Data file saved to: ${exportDestination.name}/${filename}`, 'success');
                        } else {
                            showStatus('‚úÖ Data file saved! Keep it in the same folder as this HTML file.', 'success');
                        }
                    } else {
                        showStatus('‚ùå Error saving data file. Please try again.', 'error');
                    }
                } catch (error) {
                    console.error('Error saving data file:', error);
                    showStatus('‚ùå Error saving data file. Please try again.', 'error');
                }
            };

            const loadDataFile = () => {
                if (dataFileInputRef.current) {
                    dataFileInputRef.current.click();
                }
            };

            const handleDataFileLoad = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        let projectsToLoad = [];
                        let ideasToLoad = [];
                        let eventsToLoad = [];

                        if (data.projects && Array.isArray(data.projects)) {
                            projectsToLoad = data.projects;
                        } else if (Array.isArray(data) && !data.projects) {
                            projectsToLoad = data;
                        }

                        if (data.pendingIdeas && Array.isArray(data.pendingIdeas)) {
                            ideasToLoad = data.pendingIdeas;
                        }
                        
                        if (data.calendarEvents && Array.isArray(data.calendarEvents)) {
                            eventsToLoad = data.calendarEvents;
                        }
                        
                        // FIXED: Preserve isArchived field when loading from file
                        const sanitizedProjects = projectsToLoad.map(p => ({
                            ...p,
                            // Keep existing isArchived value, don't force to false
                            isArchived: p.isArchived === true,
                        }));
                        
                        setProjects(sanitizedProjects);
                        setPendingIdeas(ideasToLoad);
                        setCalendarEvents(eventsToLoad);
                        setExpandedProject(null);
                        
                        // Show accurate counts including archived projects
                        const archivedCount = sanitizedProjects.filter(p => p.isArchived).length;
                        const activeCount = sanitizedProjects.length - archivedCount;
                        showStatus(
                            `‚úÖ Loaded ${activeCount} active projects, ${archivedCount} archived projects, ${ideasToLoad.length} ideas, and ${eventsToLoad.length} events from data file!`, 
                            'success'
                        );
                    } catch (error) {
                        console.error('Load error:', error);
                        showStatus('‚ùå Error loading data file. Please check the file format.', 'error');
                    }
                };
                reader.onerror = () => {
                    showStatus('‚ùå Error reading file. Please try again.', 'error');
                };
                reader.readAsText(file);
                
                if (dataFileInputRef.current) {
                    dataFileInputRef.current.value = '';
                }
            };

            const handleImportanceChange = (e) => {
                const value = e.target.value;
                setCurrentProject(prev => ({ ...prev, importance: value }));
                setShowCompletionDate(value === 'important');
            };

            const addProject = () => {
                if (!currentProject.name.trim()) {
                    alert('Please enter a project name');
                    return;
                }
                
                if (currentProject.importance === 'important' && !currentProject.completionDate) {
                    alert('Please enter a completion date for important projects. (ANDRE Right Focus Nudge)');
                    return;
                }

                const now = new Date();
                const workSession = {
                    id: Date.now(),
                    timestamp: now.toISOString(),
                    date: now.toLocaleDateString(),
                    time: now.toLocaleTimeString(),
                    description: currentProject.description.trim()
                };

                const newProject = {
                    ...currentProject,
                    id: Date.now() + Math.random(),
                    workSessions: [workSession],
                    isComplete: false,
                    isArchived: false, // NEW: Default to not archived
                    account: currentProject.account.trim(),
                    aiModel: currentProject.aiModel.trim(),
                    largeData: currentProject.largeData.trim(),
                    timestamp: workSession.timestamp,
                    date: workSession.date,
                    time: workSession.time,
                    description: workSession.description
                };
                
                if (newProject.importance !== 'important') {
                    newProject.completionDate = '';
                }

                setProjects(prev => [newProject, ...prev]);
                setExpandedProject(null);
                
                setCurrentProject({
                    name: '',
                    account: '',
                    aiModel: currentProject.aiModel,
                    description: '',
                    largeData: '',
                    importance: 'not_important',
                    completionDate: ''
                });
                setShowCompletionDate(false);

                showStatus('‚úÖ Project logged successfully! (ANDRE is now tracking progress)', 'success');

                setTimeout(() => {
                    document.getElementById('view-logs')?.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            };

            const addWorkSession = (projectId, sessionDescription = '') => {
                const now = new Date();
                const newWorkSession = {
                    id: Date.now(),
                    timestamp: now.toISOString(),
                    date: now.toLocaleDateString(),
                    time: now.toLocaleTimeString(),
                    description: sessionDescription.trim()
                };

                setProjects(prev => prev.map(project => {
                    if (project.id === projectId) {
                        const updatedProject = {
                            ...project,
                            workSessions: [...(project.workSessions || []), newWorkSession],
                            timestamp: newWorkSession.timestamp,
                            date: newWorkSession.date,
                            time: newWorkSession.time,
                            isComplete: false,
                            isArchived: false, // Ensure project is unarchived when a new session is added
                        };
                        
                        // Handle conversion from old format where log entry was not a session
                        if (!project.workSessions) {
                            updatedProject.workSessions = [
                                {
                                    id: project.id + '_original',
                                    timestamp: project.timestamp,
                                    date: project.date,
                                    time: project.time,
                                    description: project.description || ''
                                },
                                newWorkSession
                            ];
                        }
                        
                        return updatedProject;
                    }
                    return project;
                }));

                showStatus('‚è∞ Work session added successfully!', 'success');
            };

            const handleAddWorkSession = (projectId) => {
                const sessionDescription = prompt(
                    'Add a note for this work session (optional):',
                    ''
                );
                
                if (sessionDescription === null) return;
                
                addWorkSession(projectId, sessionDescription);
            };

            const toggleProjectCompletion = (projectId) => {
                setProjects(prev => prev.map(project => {
                    if (project.id === projectId) {
                        const newStatus = !project.isComplete;
                        showStatus(`Project marked as ${newStatus ? '‚úÖ Complete' : '‚ö†Ô∏è In-progress'}`, 'info');
                        return { ...project, isComplete: newStatus, isArchived: false }; // Unarchive on status change
                    }
                    return project;
                }));
            };
            
            // NEW: Function to archive a project
            const archiveProject = (projectId) => {
                if (window.confirm('Are you sure you want to archive this project? It will be moved to the Archive folder and removed from the active log view.')) {
                    setProjects(prev => prev.map(project => {
                        if (project.id === projectId) {
                            showStatus(`üìÅ Project **${project.name}** archived.`, 'info');
                            return { ...project, isArchived: true, isComplete: false }; // Ensure it's not marked complete
                        }
                        return project;
                    }));
                    if (expandedProject === projectId) {
                        setExpandedProject(null);
                    }
                    // Scroll to archive section if it was archived
                    setTimeout(() => {
                         document.getElementById('archive-section')?.scrollIntoView({ behavior: 'smooth' });
                         setShowArchive(true); // Open the archive section
                    }, 100);
                }
            };
            
            // NEW: Function to restore a project from the archive
            const restoreProject = (projectId) => {
                setProjects(prev => prev.map(project => {
                    if (project.id === projectId) {
                        showStatus(`‚§¥Ô∏è Project **${project.name}** restored to active logs.`, 'success');
                        return { ...project, isArchived: false, isComplete: false }; // Restore to active, in-progress state
                    }
                    return project;
                }));
            };


            const startEditingSession = (projectId, sessionId, description) => {
                setEditingSession({ projectId, sessionId, description });
            };
            
            const handleSessionEditChange = (e) => {
                const { value } = e.target;
                setEditingSession(prev => ({ ...prev, description: value }));
            };

            const saveEditedSession = (event) => {
                event.preventDefault();
                const { projectId, sessionId, description: newDescription } = editingSession;

                setProjects(prev => prev.map(project => {
                    if (project.id === projectId) {
                        const updatedWorkSessions = (project.workSessions || []).map(session => {
                            if (session.id === sessionId) {
                                return { ...session, description: newDescription };
                            }
                            return session;
                        });

                        if (sessionId === project.id + '_original') {
                            return { ...project, description: newDescription, workSessions: updatedWorkSessions };
                        }

                        return { ...project, workSessions: updatedWorkSessions };
                    }
                    return project;
                }));

                setEditingSession(null);
                showStatus('üìù Session details updated!', 'success');
            };
            
            const openEditProjectModal = (project) => {
                setEditingProject(project);
            };

            const closeEditProjectModal = () => {
                setEditingProject(null);
            };

            const handleModalChange = (e) => {
                const { name, value } = e.target;
                
                setLocalEditingProject(prev => {
                    if (!prev) return null;
                    const updated = {
                        ...prev,
                        [name]: value
                    };
                    
                    if (name === 'importance') {
                        setShowCompletionDate(value === 'important');
                    }

                    return updated;
                });
            };

            const saveEditedProject = (e) => {
                e.preventDefault();

                if (!localEditingProject) return;

                const updatedProject = {
                    ...localEditingProject,
                    name: localEditingProject.name.trim(),
                    account: localEditingProject.account.trim(),
                    aiModel: localEditingProject.aiModel.trim(),
                    largeData: localEditingProject.largeData.trim()
                };

                if (!updatedProject.name) {
                    alert('Project name cannot be empty.');
                    return;
                }
                
                if (updatedProject.importance === 'important' && !updatedProject.completionDate) {
                    alert('Please enter a completion date for important projects.');
                    return;
                }
                
                if (updatedProject.importance !== 'important') {
                    updatedProject.completionDate = '';
                }
                
                // Ensure archiving is handled correctly during edit
                if (updatedProject.isArchived) {
                    updatedProject.isArchived = false; // Editing implies it's being actively reviewed/restored
                    showStatus('‚§¥Ô∏è Project restored from archive on edit.', 'success');
                }

                setProjects(prev => prev.map(project => 
                    project.id === updatedProject.id ? updatedProject : project
                ));
                
                showStatus('üìù Project details updated!', 'success');
                closeEditProjectModal();
            };

            const toggleProjectExpansion = (projectId) => {
                setExpandedProject(expandedProject === projectId ? null : projectId);
                // Ensure data is hidden when collapsing
                if (expandedProject === projectId) {
                    setVisibleDataId(null); 
                }
            };

            const getWorkSessionsCount = (project) => {
                if (!project.workSessions) return 1;
                return project.workSessions.length;
            };

            const getProjectDuration = (project) => {
                if (!project.workSessions || project.workSessions.length < 2) {
                    return 'Single session';
                }
                
                const firstSession = project.workSessions[0];
                const lastSession = project.workSessions[project.workSessions.length - 1];
                
                const startDate = new Date(firstSession.timestamp);
                const endDate = new Date(lastSession.timestamp);
                const diffMs = endDate - startDate;
                
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                if (diffDays > 0) {
                    return `${diffDays} day${diffDays > 1 ? 's' : ''}, ${diffHours} hour${diffHours !== 1 ? 's' : ''}`;
                } else if (diffHours > 0) {
                    return `${diffHours} hour${diffHours > 1 ? 's' : ''}`;
                } else {
                    const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                    return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''}`;
                }
            };

            const handleAccountChange = (value) => {
                setCurrentProject(prev => ({ ...prev, account: value }));
                const filtered = accountSuggestions.filter(acc => 
                    acc.toLowerCase().includes(value.toLowerCase())
                );
                setShowAccountSuggestions(value.length > 0 && filtered.length > 0);
            };

            const selectAccount = (account) => {
                setCurrentProject(prev => ({ ...prev, account }));
                setShowAccountSuggestions(false);
            };

            const deleteProject = (id) => {
                if (window.confirm('Are you sure you want to delete this project log? This action is permanent.')) {
                    setProjects(prev => prev.filter(project => project.id !== id));
                    if (expandedProject === id) {
                        setExpandedProject(null);
                    }
                    showStatus('üóëÔ∏è Project deleted permanently', 'info');
                }
            };

            const exportData = async () => {
                try {
                    const filename = `project-logs-backup-${new Date().toISOString().split('T')[0]}.json`;
                    const dataToExport = {
                        projects: projects,
                        pendingIdeas: pendingIdeas,
                        calendarEvents: calendarEvents
                    };
                    const success = await saveToDestination(filename, dataToExport);
                    
                    if (success) {
                        if (exportDestination && isFileSystemAccessSupported) {
                            showStatus(`üíæ Backup exported to: ${exportDestination.name}/${filename}`, 'success');
                        } else {
                            showStatus('üíæ Backup exported successfully!', 'success');
                        }
                    } else {
                        showStatus('‚ùå Error exporting data. Please try again.', 'error');
                    }
                } catch (error) {
                    console.error('Error exporting data:', error);
                    showStatus('‚ùå Error exporting data. Please try again.', 'error');
                }
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        
                        let importedProjects = [];
                        let importedIdeas = [];
                        let importedEvents = [];
                        
                        if (imported.projects && Array.isArray(imported.projects)) {
                            importedProjects = imported.projects;
                        } else if (Array.isArray(imported)) {
                            importedProjects = imported;
                        }
                        
                        if (imported.pendingIdeas && Array.isArray(imported.pendingIdeas)) {
                            importedIdeas = imported.pendingIdeas;
                        }
                        
                        if (imported.calendarEvents && Array.isArray(imported.calendarEvents)) {
                            importedEvents = imported.calendarEvents;
                        }
                        
                        // FIXED: Preserve isArchived field during import
                        const sanitizedImportedProjects = importedProjects.map(p => ({
                            ...p,
                            // Keep the imported isArchived status
                            isArchived: p.isArchived === true,
                        }));
                        
                        const existingProjectIds = new Set(projects.map(p => p.id));
                        const existingIdeaIds = new Set(pendingIdeas.map(i => i.id));
                        const existingEventIds = new Set(calendarEvents.map(e => e.id));

                        const newProjects = sanitizedImportedProjects.filter(p => !existingProjectIds.has(p.id));
                        const newIdeas = importedIdeas.filter(i => !existingIdeaIds.has(i.id));
                        const newEvents = importedEvents.filter(e => !existingEventIds.has(e.id));

                        setProjects(prev => [...newProjects, ...prev]);
                        setPendingIdeas(prev => [...newIdeas, ...prev]);
                        setCalendarEvents(prev => [...newEvents, ...prev]);
                        setExpandedProject(null);
                        
                        const newArchivedCount = newProjects.filter(p => p.isArchived).length;
                        const newActiveCount = newProjects.length - newArchivedCount;
                        showStatus(
                            `üì• Imported ${newActiveCount} active projects, ${newArchivedCount} archived projects, ${newIdeas.length} ideas, and ${newEvents.length} events successfully!`, 
                            'success'
                        );
                    } catch (error) {
                        console.error('Import error:', error);
                        showStatus('‚ùå Error importing file. Please check the file format.', 'error');
                    }
                };
                reader.onerror = () => {
                    showStatus('‚ùå Error reading file. Please try again.', 'error');
                };
                reader.readAsText(file);
                
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && currentProject.name.trim()) {
                    addProject();
                }
            };

            const handleIdeaKeyPress = (e) => {
                if (e.key === 'Enter' && currentIdea.trim()) {
                    addIdea();
                }
            };

            const addIdea = () => {
                if (!currentIdea.trim()) {
                    alert('Please enter a new idea.');
                    return;
                }
                const newIdea = {
                    id: Date.now() + Math.random(),
                    text: currentIdea.trim(),
                    timestamp: new Date().toISOString()
                };
                setPendingIdeas(prev => [newIdea, ...prev]);
                setCurrentIdea('');
                showStatus('üí° Idea added to "Idea Box"!', 'info');
            };

            const convertIdeaToProject = (ideaId) => {
                const ideaToConvert = pendingIdeas.find(idea => idea.id === ideaId);
                if (!ideaToConvert) return;

                const newProject = {
                    id: Date.now() + Math.random(),
                    name: ideaToConvert.text,
                    description: '',
                    largeData: '',
                    account: '',
                    aiModel: '',
                    isComplete: false,
                    isArchived: false, // Default unarchived
                    workSessions: [],
                    importance: 'not_important',
                    completionDate: '',
                    timestamp: new Date().toISOString()
                };

                setProjects(prev => [newProject, ...prev]);
                setPendingIdeas(prev => prev.filter(idea => idea.id !== ideaId));
                showStatus('üöÄ Idea converted to a new project!', 'success');
            };

            const deleteIdea = (ideaId) => {
                if (window.confirm('Are you sure you want to delete this idea?')) {
                    setPendingIdeas(prev => prev.filter(idea => idea.id !== ideaId));
                    showStatus('üóëÔ∏è Idea deleted', 'info');
                }
            };
            
            const addCalendarEvent = () => {
                if (!currentEvent.title.trim() || !currentEvent.date.trim()) {
                    alert('Please enter an event title and a date.');
                    return;
                }
                
                const newEvent = {
                    id: Date.now() + Math.random(),
                    title: currentEvent.title.trim(),
                    date: currentEvent.date,
                    notes: currentEvent.notes.trim(),
                    timestamp: new Date().toISOString()
                };
                
                setCalendarEvents(prev => [...prev, newEvent]);
                setCurrentEvent({ title: '', date: '', notes: '' });
                showStatus('üóìÔ∏è Calendar event added!', 'success');
            };

            const deleteCalendarEvent = (eventId) => {
                if (window.confirm('Are you sure you want to delete this calendar event?')) {
                    setCalendarEvents(prev => prev.filter(event => event.id !== eventId));
                    showStatus('üóëÔ∏è Event deleted', 'info');
                }
            };

            const sortCalendarEvents = (events) => {
                return events.sort((a, b) => new Date(a.date) - new Date(b.date));
            };
            
            // Helper function to sort projects (active or archived)
            const sortProjects = (projs) => {
                // Filter out archived projects for active list (or incomplete for the archive list if needed, but here we sort all)
                const incomplete = projs.filter(p => !p.isComplete)
                                        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                const completed = projs.filter(p => p.isComplete)
                                       .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                return [...incomplete, ...completed];
            };

            const getFilteredSuggestions = () => {
                return accountSuggestions.filter(acc => 
                    acc.toLowerCase().includes(currentProject.account.toLowerCase())
                );
            };

            const isReadyToReview = (project) => {
                const sevenDays = 7 * 24 * 60 * 60 * 1000;
                const sessions = project.workSessions || [];

                if (project.isComplete || project.isArchived || sessions.length < 5) return false;
                
                const lastSessionTimestamp = sessions.reduce((latest, session) => {
                    const currentTimestamp = new Date(session.timestamp).getTime();
                    return currentTimestamp > latest ? currentTimestamp : latest;
                }, 0);

                return (Date.now() - lastSessionTimestamp) > sevenDays;
            };


            const aiModels = ['GPT-4', 'GPT-3.5', 'Claude 3', 'Claude 2', 'Gemini', 'PaLM', 'Custom'];
            
            // Filter projects into active and archived lists
            const activeProjects = projects.filter(p => !p.isArchived);
            const archivedProjects = projects.filter(p => p.isArchived);
            
            const sortedProjects = sortProjects(activeProjects);
            const sortedArchivedProjects = sortProjects(archivedProjects);
            
            const sortedEvents = sortCalendarEvents(calendarEvents);
            const latestIncompleteProject = sortedProjects.find(p => !p.isComplete);
            
            // ANDRE Right Focus Priority Calculation
            const priorityFocus = calculatePriority(projects, calendarEvents); // Calculate priority based on all non-archived projects

            const handleLockApp = () => {
                sessionStorage.removeItem('appUnlocked');
                setIsLocked(true);
            };

            // === MAIN RENDER CONTROL START ===
            if (needsSetup) {
                return <PasswordSetup onSetup={() => {
                    setNeedsSetup(false);
                    setIsLocked(false);
                }} />;
            }

            if (isLocked) {
                return <PasswordProtection onUnlock={() => setIsLocked(false)} />;
            }
            // === MAIN RENDER CONTROL END ===


            return (
                <div className="container">
                    {/* Header */}
                    <header className="header">
                        <h1 className="title">Project Time Logger</h1>
                        <p className="subtitle">Portable logging - v3.5 with **ANDRE** Focus Logic & Project Archiving</p>
                        
                        <button 
                            onClick={handleLockApp}
                            className="storage-button"
                            style={{ 
                                background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                                position: 'absolute',
                                top: '1rem',
                                right: '1rem',
                                color: 'white'
                            }}
                            title="Lock application"
                        >
                            üîí Lock
                        </button>
                    </header>

                    {/* Portable Storage Info */}
                    <div className="portable-info">
                        <h3>üíø Portable Storage System</h3>
                        <p>Your project logs are stored locally and can be saved to a data file that travels with this HTML file. Perfect for USB drives!</p>
                        <p><strong>How to use:</strong> Save your data file to the same folder as this HTML file. Load it on any computer to restore your logs.</p>
                        
                        <div className="storage-actions">
                            <button onClick={saveDataFile} className="storage-button save">
                                <span className="icon icon-download"></span>
                                Save Data File
                            </button>
                            <button onClick={loadDataFile} className="storage-button load">
                                <span className="icon icon-folder"></span>
                                Load Data File
                            </button>
                            {isFileSystemAccessSupported && (
                                <button onClick={chooseExportDestination} className="storage-button destination">
                                    <span className="icon icon-destination"></span>
                                    Choose Export Folder
                                </button>
                            )}
                            {exportDestination && (
                                <button onClick={resetExportDestination} className="storage-button reset">
                                    <span className="icon icon-reset"></span>
                                    Reset Destination
                                </button>
                            )}
                        </div>

                        {exportDestination && (
                            <div className="destination-info">
                                <strong>Current export destination:</strong> 
                                <span className="destination-path">{exportDestination.name}</span>
                                <br />
                                <small>All exports will be saved to this folder automatically.</small>
                            </div>
                        )}
                        
                        {statusMessage && (
                            <div className={`status-message ${statusMessage.type}`}>
                                {statusMessage.text}
                            </div>
                        )}
                        
                        <input
                            ref={dataFileInputRef}
                            type="file"
                            accept=".json"
                            onChange={handleDataFileLoad}
                            className="hidden"
                        />
                    </div>

                    {/* NEW: Project Priority Focus Card (ANDRE Right Focus) */}
                    {(activeProjects.length > 0 || calendarEvents.length > 0) && (
                        <div className="priority-card">
                            <h3>
                                <span className="icon icon-priority"></span>
                                ANDRE Right Focus: Your Next Priority
                            </h3>
                            <div className="priority-message">
                                **{priorityFocus.message}**
                            </div>
                            {priorityFocus.action !== 'none' && (
                                <button 
                                    onClick={handlePriorityAction} 
                                    className="priority-action-btn"
                                >
                                    {priorityFocus.action === 'focus-project' || priorityFocus.action === 'complete-project' ? 'Go to Project' : 
                                     priorityFocus.action === 'edit-project' ? 'Set Deadline' :
                                     priorityFocus.action === 'focus-event' ? 'View Event' : 
                                     priorityFocus.action === 'add-idea' ? 'Start Idea' : 'Focus'}
                                </button>
                            )}
                        </div>
                    )}


                    {/* Pending Ideas Section - "Idea Box" */}
                    <div className="idea-card" id="idea-box">
                        <h2 className="idea-title">
                            <span className="icon icon-lightbulb"></span>
                            Idea Box (Pending Projects)
                        </h2>
                        
                        <div className="form-grid">
                            <div className="form-group">
                                <label className="form-label">New Idea</label>
                                <input
                                    type="text"
                                    value={currentIdea}
                                    onChange={(e) => setCurrentIdea(e.target.value)}
                                    onKeyPress={handleIdeaKeyPress}
                                    className="form-input"
                                    placeholder="Jot down a project idea here..."
                                />
                            </div>
                            <button onClick={addIdea} className="submit-button">
                                <span className="icon icon-plus"></span>
                                Add Idea
                            </button>
                        </div>
                        
                        {pendingIdeas.length > 0 && (
                            <div className="idea-list" style={{ marginTop: '1.5rem' }}>
                                {pendingIdeas.map(idea => (
                                    <div key={idea.id} className="idea-item">
                                        <div className="idea-text">{idea.text}</div>
                                        <div className="idea-actions">
                                            <button 
                                                onClick={() => convertIdeaToProject(idea.id)} 
                                                className="convert-btn"
                                                title="Convert to project log"
                                            >
                                                Convert
                                            </button>
                                            <button 
                                                onClick={() => deleteIdea(idea.id)} 
                                                className="delete-button"
                                                title="Delete idea"
                                            >
                                                <span className="icon icon-trash"></span>
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Calendar and Events Section */}
                    <div className="calendar-card" id="calendar-card">
                        <h2 className="calendar-title">
                            <span className="icon icon-calendar"></span>
                            Calendar & Events
                        </h2>
                        
                        <div className="form-grid grid-2">
                            {/* Event Title */}
                            <div className="form-group">
                                <label className="form-label">Event/Task Title *</label>
                                <input
                                    type="text"
                                    value={currentEvent.title}
                                    onChange={(e) => setCurrentEvent(prev => ({ ...prev, title: e.target.value }))}
                                    className="form-input"
                                    placeholder="e.g., Deploy Beta V1.0"
                                    required
                                />
                            </div>
                            {/* Event Date */}
                            <div className="form-group">
                                <label className="form-label">Date *</label>
                                <input
                                    type="date"
                                    value={currentEvent.date}
                                    onChange={(e) => setCurrentEvent(prev => ({ ...prev, date: e.target.value }))}
                                    className="form-input"
                                    required
                                />
                            </div>
                            {/* Event Notes (Full-width group) */}
                            <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                                <label className="form-label">Notes</label>
                                <textarea
                                    value={currentEvent.notes}
                                    onChange={(e) => setCurrentEvent(prev => ({ ...prev, notes: e.target.value }))}
                                    className="form-textarea"
                                    placeholder="Any details or reminders for this event..."
                                />
                            </div>
                            {/* Add Event Button (Full-width group) */}
                            <div style={{ gridColumn: '1 / -1' }}>
                                <button onClick={addCalendarEvent} className="submit-button calendar">
                                    <span className="icon icon-plus"></span>
                                    Schedule Event
                                </button>
                            </div>
                        </div>
                        
                        {sortedEvents.length > 0 && (
                            <div className="event-list">
                                {sortedEvents.map(event => (
                                    <div key={event.id} className="event-item">
                                        <div className="event-info">
                                            <div className="event-title-date">
                                                {event.date} - {event.title}
                                            </div>
                                            {event.notes && (
                                                <div className="event-notes">{event.notes}</div>
                                            )}
                                        </div>
                                        <button 
                                            onClick={() => deleteCalendarEvent(event.id)} 
                                            className="delete-button"
                                            title="Delete event"
                                        >
                                            <span className="icon icon-trash"></span>
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                        {sortedEvents.length === 0 && (
                            <div className="empty-state" style={{ marginTop: '1.5rem', padding: '1.5rem' }}>
                                <div className="empty-icon">üéâ</div>
                                <p className="empty-text">No scheduled events yet. Add one above!</p>
                            </div>
                        )}
                    </div>

                    {/* Log Entry Form - UPDATED with Right Focus Nudge */}
                    <div className="form-card">
                        <h2 className="form-title">
                            <span className="icon icon-plus"></span>
                            Add New Project Log
                        </h2>

                        <div className="form-grid">
                            {/* Project Name */}
                            <div className="form-group">
                                <label className="form-label">Project Name *</label>
                                <input
                                    type="text"
                                    value={currentProject.name}
                                    onChange={(e) => setCurrentProject(prev => ({ ...prev, name: e.target.value }))}
                                    onKeyPress={handleKeyPress}
                                    className="form-input"
                                    placeholder="Enter project name"
                                />
                            </div>

                            {/* Importance and Completion Date Grid */}
                            <div className="form-grid grid-2">
                                {/* Importance Field */}
                                <div className="form-group">
                                    <label className="form-label">Importance</label>
                                    <select
                                        value={currentProject.importance}
                                        onChange={handleImportanceChange}
                                        className="form-select"
                                    >
                                        <option value="not_important">Not Important</option>
                                        <option value="important">Important</option>
                                    </select>
                                </div>
                                {/* Completion Date Field (conditionally rendered) */}
                                {showCompletionDate && (
                                    <div className="form-group">
                                        <label className="form-label">Completion Date *</label>
                                        <input
                                            type="date"
                                            value={currentProject.completionDate}
                                            onChange={(e) => setCurrentProject(prev => ({ ...prev, completionDate: e.target.value }))}
                                            className="form-input"
                                        />
                                        {/* NEW: Right Focus Nudge for empty date */}
                                        {!currentProject.completionDate && (
                                            <p style={{ color: '#f59e0b', fontSize: '0.75rem', marginTop: '0.25rem' }}>
                                                üéØ **Right Focus Tip:** A deadline is critical for important tasks.
                                            </p>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Account and AI Model Grid */}
                            <div className="form-grid grid-2">
                                {/* Account */}
                                <div className="form-group">
                                    <label className="form-label">Account Used</label>
                                    <input
                                        type="text"
                                        value={currentProject.account}
                                        onChange={(e) => handleAccountChange(e.target.value)}
                                        onFocus={() => {
                                            const filtered = getFilteredSuggestions();
                                            setShowAccountSuggestions(filtered.length > 0);
                                        }}
                                        onBlur={() => setTimeout(() => setShowAccountSuggestions(false), 200)}
                                        className="form-input"
                                        placeholder="e.g., Google, Hotmail, GitHub"
                                    />
                                    
                                    {/* Account Suggestions */}
                                    {showAccountSuggestions && (
                                        <div className="suggestions">
                                            {getFilteredSuggestions().map((account, index) => (
                                                <button
                                                    key={index}
                                                    onMouseDown={(e) => e.preventDefault()}
                                                    onClick={() => selectAccount(account)}
                                                    className="suggestion-item"
                                                >
                                                    {account}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* AI Model */}
                                <div className="form-group">
                                    <label className="form-label">AI Model Used</label>
                                    <select
                                        value={currentProject.aiModel}
                                        onChange={(e) => setCurrentProject(prev => ({ ...prev, aiModel: e.target.value }))}
                                        className="form-select"
                                    >
                                        <option value="">Select AI model</option>
                                        {aiModels.map(model => (
                                            <option key={model} value={model}>{model}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            {/* Description (Small Notes) */}
                            <div className="form-group">
                                <label className="form-label">Session Notes (Small)</label>
                                <textarea
                                    value={currentProject.description}
                                    onChange={(e) => setCurrentProject(prev => ({ ...prev, description: e.target.value }))}
                                    className="form-textarea"
                                    placeholder="Add any brief session notes or description..."
                                />
                            </div>
                            
                            {/* Project Data / Long Notes (Gigantic Textarea) */}
                            <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                                <label className="form-label">Project Data / Long Notes (10,000+ line capacity)</label>
                                <textarea
                                    value={currentProject.largeData}
                                    onChange={(e) => setCurrentProject(prev => ({ ...prev, largeData: e.target.value }))}
                                    className="form-input form-gigantic-textarea"
                                    placeholder="Paste code, book chapters, or any large amount of text here. This will be stored with the project."
                                />
                            </div>

                            {/* Save Button */}
                            <button onClick={addProject} className="submit-button">
                                <span className="icon icon-save"></span>
                                Save Project Log (Auto Timestamp)
                            </button>
                        </div>
                    </div>

                    {/* View Logs Section */}
                    <div id="view-logs">
                        <div className="logs-header">
                            <h2 className="logs-title">
                                <span className="icon icon-eye"></span>
                                Active Project Logs ({sortedProjects.length})
                            </h2>

                            {/* Export/Import Controls */}
                            {projects.length > 0 && (
                                <div className="button-group">
                                    <button onClick={exportData} className="export-button">
                                        <span className="icon icon-download"></span>
                                        Export Backup
                                    </button>
                                    
                                    <label className="import-button">
                                        <span className="icon icon-upload"></span>
                                        Import
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".json"
                                            onChange={importData}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                            )}
                        </div>

                        {/* Projects List - Active */}
                        <div className="logs-container">
                            {sortedProjects.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-icon">üìã</div>
                                    <p className="empty-text">No active project logs yet. Add your first project above!</p>
                                </div>
                            ) : (
                                sortedProjects.map((project) => {
                                    const isExpanded = expandedProject === project.id;
                                    const workSessionsCount = getWorkSessionsCount(project);
                                    const projectDuration = getProjectDuration(project);
                                    const showReviewNudge = isReadyToReview(project);
                                    
                                    return (
                                        <div 
                                            key={project.id} 
                                            id={project.id}
                                            className={`log-card ${project.id === latestIncompleteProject?.id ? 'latest' : ''} ${isExpanded ? 'expanded' : ''} ${!project.isComplete ? 'incomplete' : 'complete'} ${isOverdue(project) ? 'overdue' : ''}`}
                                        >
                                            <div className="log-header">
                                                <div>
                                                    <h3 className="log-title">{project.name}</h3>
                                                    <div className="log-meta">
                                                        <span>{project.date}</span>
                                                        <span>{project.time}</span>
                                                        {project.id === latestIncompleteProject?.id && <span className="latest-badge">Latest</span>}
                                                        {project.isComplete && <span className="completed-badge">‚úÖ Complete</span>}
                                                        {!project.isComplete && <span className="incomplete-badge">‚ö†Ô∏è In-progress</span>}
                                                        {project.importance === 'important' && (
                                                            <span className="log-importance-badge important">‚≠ê Important</span>
                                                        )}
                                                        {isOverdue(project) && (
                                                            <span className="log-importance-badge critical-focus">‚ùó CRITICAL FOCUS</span>
                                                        )}
                                                        {project.id === priorityFocus.projectId && priorityFocus.action === 'focus-project' && !isOverdue(project) && (
                                                            <span className="log-importance-badge important">üéØ HIGH FOCUS</span>
                                                        )}
                                                    </div>
                                                    
                                                    {/* Project Statistics */}
                                                    <div className="project-stats">
                                                        <div className="stat-item">
                                                            <span className="icon icon-clock"></span>
                                                            <span>{workSessionsCount} session{workSessionsCount !== 1 ? 's' : ''}</span>
                                                        </div>
                                                        <div className="stat-item">
                                                            <span>üìà</span>
                                                            <span>{projectDuration}</span>
                                                        </div>
                                                        {project.completionDate && (
                                                            <div className="stat-item">
                                                                <span>üìÖ</span>
                                                                <span>Due: {project.completionDate}</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'flex-start' }}>
                                                    {/* NEW: Archive Button */}
                                                    <button
                                                        onClick={() => archiveProject(project.id)}
                                                        className="edit-project-btn"
                                                        title="Archive project (Move out of active log)"
                                                        style={{ background: 'linear-gradient(135deg, #a1a1aa, #71717a)', color: 'white', border: 'none' }}
                                                    >
                                                        üìÅ Archive
                                                    </button>
                                                    
                                                    {/* Edit Project Button */}
                                                    <button
                                                        onClick={() => openEditProjectModal(project)}
                                                        className="edit-project-btn"
                                                        title="Edit project details"
                                                    >
                                                        ‚úèÔ∏è Edit Project
                                                    </button>
                                                    
                                                    {/* Toggle Complete Button */}
                                                    <button
                                                        onClick={() => toggleProjectCompletion(project.id)}
                                                        className="complete-toggle-btn"
                                                        title={project.isComplete ? "Mark as In-progress" : "Mark as Complete"}
                                                    >
                                                        {project.isComplete ? 'Undo' : 'Complete'}
                                                    </button>
                                                    
                                                    {/* Add Work Session Button */}
                                                    <button
                                                        onClick={() => handleAddWorkSession(project.id)}
                                                        className="add-session-btn"
                                                        title="Add work session"
                                                    >
                                                        <span className="icon icon-clock"></span>
                                                        Add Session
                                                    </button>
                                                    
                                                    {/* Expand/Collapse Toggle */}
                                                    <button
                                                        onClick={() => toggleProjectExpansion(project.id)}
                                                        className="expand-toggle"
                                                        title={isExpanded ? "Hide sessions" : "Show sessions"}
                                                    >
                                                        <span className="icon icon-expand"></span>
                                                        {isExpanded ? 'Hide' : 'Show'}
                                                    </button>
                                                    
                                                    {/* Delete Button */}
                                                    <button
                                                        onClick={() => deleteProject(project.id)}
                                                        className="delete-button"
                                                        title="Delete project log"
                                                    >
                                                        <span className="icon icon-trash"></span>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div className="log-details">
                                                <div className="detail-item">
                                                    <span className="detail-label">Account:</span>
                                                    <div className="detail-value">
                                                        {project.account || 'Not specified'}
                                                    </div>
                                                </div>
                                                <div className="detail-item">
                                                    <span className="detail-label">AI Model:</span>
                                                    <div className="detail-value">
                                                        {project.aiModel || 'Not specified'}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Original Description (Small Notes - if exists and no work sessions) */}
                                            {project.description && (!project.workSessions || project.workSessions.length === 0) && (
                                                <div className="log-description">
                                                    <span className="description-label">Notes:</span>
                                                    <div className="description-content">
                                                        {project.description}
                                                    </div>
                                                </div>
                                            )}

                                            {/* NEW: Project Data / Long Notes - With Show/Hide Toggle */}
                                            {project.largeData && (
                                                <div className="log-description">
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                        <span className="description-label">Project Data / Long Notes:</span>
                                                        
                                                        <button 
                                                            onClick={() => setVisibleDataId(visibleDataId === project.id ? null : project.id)}
                                                            className="data-toggle-btn" 
                                                            title={visibleDataId === project.id ? "Hide sensitive data" : "Show project data"}
                                                        >
                                                            <span className="icon icon-eye"></span>
                                                            {visibleDataId === project.id ? 'Hide Data' : 'Show Data'}
                                                        </button>
                                                    </div>

                                                    {/* Conditional Content Display */}
                                                    {visibleDataId === project.id ? (
                                                        <div className="description-content" style={{ whiteSpace: 'pre-wrap', maxHeight: '400px', overflowY: 'auto' }}>
                                                            {project.largeData}
                                                        </div>
                                                    ) : (
                                                        <div className="description-content" style={{ padding: '0.75rem', textAlign: 'center', color: 'rgba(255,255,255,0.5)' }}>
                                                            Data is hidden for security. Click 'Show Data' to view.
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                            
                                            {/* Work Sessions (Expanded View) */}
                                            {isExpanded && (
                                                <div className="work-sessions">

                                                    {/* NEW: Clear Path Completion Nudge */}
                                                    {showReviewNudge && (
                                                        <div className="completion-nudge">
                                                            <p style={{ fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                                üí° **Clear Path Suggestion:** This project may be ready for **Review** or **Closure**.
                                                            </p>
                                                            <button 
                                                                onClick={() => toggleProjectCompletion(project.id)}
                                                                className="nudge-complete-btn"
                                                                title="Mark as Complete"
                                                            >
                                                                Mark as Complete
                                                            </button>
                                                        </div>
                                                    )}

                                                    <div className="work-sessions-header">
                                                        <h4 className="work-sessions-title">
                                                            Work Sessions ({workSessionsCount})
                                                        </h4>
                                                    </div>
                                                    
                                                    <div>
                                                        {(project.workSessions || []).length > 0 ? (
                                                            (project.workSessions || []).map((session, sessionIndex) => (
                                                                editingSession && editingSession.sessionId === session.id ? (
                                                                    <form onSubmit={saveEditedSession} key={session.id} className="edit-form">
                                                                        <textarea
                                                                            name="description"
                                                                            value={editingSession.description}
                                                                            onChange={handleSessionEditChange}
                                                                            className="form-textarea"
                                                                            required
                                                                        />
                                                                        <div className="edit-actions">
                                                                            <button type="submit" className="save-edit-btn">Save</button>
                                                                            <button type="button" onClick={() => setEditingSession(null)} className="cancel-edit-btn">Cancel</button>
                                                                        </div>
                                                                    </form>
                                                                ) : (
                                                                    <div key={session.id} className="work-session-item">
                                                                        <div className="session-info">
                                                                            <div className="session-time">
                                                                                {session.date} at {session.time}
                                                                            </div>
                                                                            <div className="session-description">
                                                                                {session.description || 'No description provided'}
                                                                            </div>
                                                                        </div>
                                                                        <div className="session-number">
                                                                            #{sessionIndex + 1}
                                                                            <button
                                                                                onClick={() => startEditingSession(project.id, session.id, session.description)}
                                                                                className="edit-session-btn"
                                                                                title="Edit session details"
                                                                            >
                                                                                ‚úèÔ∏è
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                )
                                                            ))
                                                        ) : (
                                                            <div className="empty-state">
                                                                <div className="empty-icon">üóìÔ∏è</div>
                                                                <p className="empty-text">No work sessions logged yet.</p>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                    
                    {/* --- Archive Section --- */}
                    <div id="archive-section" style={{ marginTop: '4rem' }}>
                        <div className="logs-header" style={{ cursor: 'pointer' }} onClick={() => setShowArchive(prev => !prev)}>
                            <h2 className="logs-title" style={{ color: '#a1a1aa' }}>
                                <span className="icon icon-folder"></span>
                                Project Archive ({sortedArchivedProjects.length})
                                <span style={{ marginLeft: '1rem', fontSize: '1rem', color: '#71717a' }}>
                                    {showArchive ? '‚ñº Hide' : '‚ñ∫ Show'}
                                </span>
                            </h2>
                        </div>
                        
                        {showArchive && (
                            <div className="logs-container">
                                {sortedArchivedProjects.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-icon">üìÇ</div>
                                        <p className="empty-text">The archive is empty. Move projects here you want to pause.</p>
                                    </div>
                                ) : (
                                    sortedArchivedProjects.map((project) => {
                                        const isExpanded = expandedProject === project.id;
                                        const workSessionsCount = getWorkSessionsCount(project);
                                        const projectDuration = getProjectDuration(project);
                                        
                                        // A slightly different style for archived projects
                                        return (
                                            <div 
                                                key={project.id} 
                                                id={project.id}
                                                className={`log-card ${isExpanded ? 'expanded' : ''}`} // Removed latest/complete classes for archived view clarity
                                                style={{ border: '1px solid rgba(161, 161, 170, 0.3)', backgroundColor: 'rgba(161, 161, 170, 0.05)' }}
                                            >
                                                <div className="log-header">
                                                    <div>
                                                        <h3 className="log-title" style={{ color: '#a1a1aa' }}>{project.name}</h3>
                                                        <div className="log-meta">
                                                            <span>Archived: {new Date(project.timestamp).toLocaleDateString()}</span>
                                                            <span className="log-importance-badge incomplete" style={{ background: 'rgba(161, 161, 170, 0.2)', color: '#a1a1aa' }}>
                                                                ‚è∏ Paused
                                                            </span>
                                                        </div>
                                                        <div className="project-stats">
                                                            <div className="stat-item">
                                                                <span className="icon icon-clock"></span>
                                                                <span>{workSessionsCount} session{workSessionsCount !== 1 ? 's' : ''}</span>
                                                            </div>
                                                            <div className="stat-item">
                                                                <span>üìà</span>
                                                                <span>{projectDuration}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'flex-start' }}>
                                                        {/* Restore Button */}
                                                        <button
                                                            onClick={() => restoreProject(project.id)}
                                                            className="storage-button load"
                                                            title="Restore to active project logs"
                                                        >
                                                            ‚§¥Ô∏è Restore
                                                        </button>
                                                        
                                                        {/* View/Edit Button - will restore upon edit */}
                                                        <button
                                                            onClick={() => openEditProjectModal(project)}
                                                            className="edit-project-btn"
                                                            title="View/Edit (will restore)"
                                                        >
                                                            ‚úèÔ∏è View/Edit
                                                        </button>
                                                        
                                                        {/* Expand/Collapse Toggle */}
                                                        <button
                                                            onClick={() => toggleProjectExpansion(project.id)}
                                                            className="expand-toggle"
                                                            title={isExpanded ? "Hide details" : "Show details"}
                                                        >
                                                            <span className="icon icon-expand"></span>
                                                            {isExpanded ? 'Hide' : 'Show'}
                                                        </button>
                                                        
                                                        {/* Delete Button (Permanent Delete) */}
                                                        <button
                                                            onClick={() => deleteProject(project.id)}
                                                            className="delete-button"
                                                            title="Delete project log permanently"
                                                        >
                                                            <span className="icon icon-trash"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                {/* Details and Sessions (Rendered if expanded, reusing existing components) */}
                                                {isExpanded && (
                                                    <>
                                                        <div className="log-details" style={{ marginTop: '1rem' }}>
                                                            <div className="detail-item">
                                                                <span className="detail-label">Account:</span>
                                                                <div className="detail-value">
                                                                    {project.account || 'Not specified'}
                                                                </div>
                                                            </div>
                                                            <div className="detail-item">
                                                                <span className="detail-label">AI Model:</span>
                                                                <div className="detail-value">
                                                                    {project.aiModel || 'Not specified'}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* Project Data / Long Notes - With Show/Hide Toggle (reused) */}
                                                        {project.largeData && (
                                                            <div className="log-description">
                                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                                    <span className="description-label">Project Data / Long Notes:</span>
                                                                    
                                                                    <button 
                                                                        onClick={() => setVisibleDataId(visibleDataId === project.id ? null : project.id)}
                                                                        className="data-toggle-btn" 
                                                                        title={visibleDataId === project.id ? "Hide sensitive data" : "Show project data"}
                                                                    >
                                                                        <span className="icon icon-eye"></span>
                                                                        {visibleDataId === project.id ? 'Hide Data' : 'Show Data'}
                                                                    </button>
                                                                </div>

                                                                {/* Conditional Content Display */}
                                                                {visibleDataId === project.id ? (
                                                                    <div className="description-content" style={{ whiteSpace: 'pre-wrap', maxHeight: '400px', overflowY: 'auto' }}>
                                                                        {project.largeData}
                                                                    </div>
                                                                ) : (
                                                                    <div className="description-content" style={{ padding: '0.75rem', textAlign: 'center', color: 'rgba(255,255,255,0.5)' }}>
                                                                        Data is hidden for security. Click 'Show Data' to view.
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                        
                                                        <div className="work-sessions">
                                                            <div className="work-sessions-header">
                                                                <h4 className="work-sessions-title" style={{ color: '#a1a1aa' }}>
                                                                    Work Sessions ({workSessionsCount})
                                                                </h4>
                                                            </div>
                                                            <div>
                                                                {(project.workSessions || []).length > 0 ? (
                                                                    (project.workSessions || []).map((session, sessionIndex) => (
                                                                        // Sessions in archive are read-only, only editable via the main edit modal which restores the project
                                                                        <div key={session.id} className="work-session-item">
                                                                            <div className="session-info">
                                                                                <div className="session-time" style={{ color: '#a1a1aa' }}>
                                                                                    {session.date} at {session.time}
                                                                                </div>
                                                                                <div className="session-description">
                                                                                    {session.description || 'No description provided'}
                                                                                </div>
                                                                            </div>
                                                                            <div className="session-number">
                                                                                #{sessionIndex + 1}
                                                                            </div>
                                                                        </div>
                                                                    ))
                                                                ) : (
                                                                    <div className="empty-state">
                                                                        <div className="empty-icon">üóìÔ∏è</div>
                                                                        <p className="empty-text">No work sessions logged yet.</p>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        )}
                    </div>

                    {/* Edit Project Modal - Project Edit Fix is retained from previous iteration */}
                    {editingProject && localEditingProject && (
                        <div className="modal">
                            <div className="modal-content">
                                <span className="modal-close" onClick={closeEditProjectModal}>√ó</span>
                                <h2 className="modal-header">Edit Project</h2>
                                <form onSubmit={saveEditedProject}>
                                    <div className="form-grid">
                                        <div className="form-group">
                                            <label className="form-label">Project Name *</label>
                                            <input
                                                type="text"
                                                name="name"
                                                value={localEditingProject.name}
                                                onChange={handleModalChange}
                                                className="form-input"
                                                required
                                            />
                                        </div>
                                        <div className="form-grid grid-2">
                                            <div className="form-group">
                                                <label className="form-label">Importance</label>
                                                <select
                                                    name="importance"
                                                    value={localEditingProject.importance}
                                                    onChange={handleModalChange}
                                                    className="form-select"
                                                >
                                                    <option value="not_important">Not Important</option>
                                                    <option value="important">Important</option>
                                                </select>
                                            </div>
                                            {showCompletionDate && ( 
                                                <div className="form-group">
                                                    <label className="form-label">Completion Date *</label>
                                                    <input
                                                        type="date"
                                                        name="completionDate"
                                                        value={localEditingProject.completionDate}
                                                        onChange={handleModalChange}
                                                        className="form-input"
                                                        required
                                                    />
                                                </div>
                                            )}
                                        </div>
                                        <div className="form-grid grid-2">
                                            <div className="form-group">
                                                <label className="form-label">Account Used</label>
                                                <input
                                                    type="text"
                                                    name="account"
                                                    value={localEditingProject.account}
                                                    onChange={handleModalChange}
                                                    className="form-input"
                                                />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">AI Model Used</label>
                                                <select
                                                    name="aiModel"
                                                    value={localEditingProject.aiModel}
                                                    onChange={handleModalChange}
                                                    className="form-select"
                                                >
                                                    <option value="">Select AI model</option>
                                                    {aiModels.map(model => (
                                                        <option key={model} value={model}>{model}</option>
                                                    ))}
                                                </select>
                                            </div>
                                        </div>
                                        {/* Large Data field in modal */}
                                        <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                                            <label className="form-label">Project Data / Long Notes</label>
                                            <textarea
                                                name="largeData"
                                                value={localEditingProject.largeData}
                                                onChange={handleModalChange}
                                                className="form-input form-gigantic-textarea"
                                                placeholder="Paste code, book chapters, or any large amount of text here."
                                            />
                                        </div>
                                        
                                        {/* ARCHIVE STATUS IN MODAL (Read-only status for clarity) */}
                                        <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                                            <label className="form-label">Archive Status</label>
                                            <div className="detail-value">
                                                {localEditingProject.isArchived ? 
                                                    '‚è∏ Archived (Saving changes will restore to active logs)' : 
                                                    '‚úÖ Active'
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    <div className="edit-actions">
                                        <button type="button" onClick={closeEditProjectModal} className="cancel-edit-btn">Cancel</button>
                                        <button type="submit" className="save-edit-btn">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Use React 18's createRoot API
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(ProjectTimeLogger));
    </script>
</body>
</html>
